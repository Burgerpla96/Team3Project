<?xml version="1.0" encoding="UTF-8"?>
<mapper namespace="com.kosmo.veve.mybatis.noticeBoard">
	<!--resultMap사용시 column속성 필수:ibatis와 다른점 -->

	<resultMap type="noticeDTO" id="noticeDTOResult">
		<!-- property:자바빈의 속성명 column:테이블의 컬럼(조회결과의 컬럼들 의미) -->
		<result property="notice_no" column="notice_no" />
		<result property="title" column="title" />
		<result property="content" column="content" />
		<result property="postDate" column="postDate" />
		<result property="userID" column="userID" />
		<!-- <result property="name" column="name"/> -->
		<result property="visitCount" column="visittCount" />

		<collection property="comments" column="notice_no"
			select="com.kosmo.veve.mybatis.noticecomment.commnetNoSelectList"
			javaType="List"
			ofType="com.kosmo.veve.board.model.NoticeCommentDTO" />
	</resultMap>

	<select id="noticeSelectList" parameterType="java.util.Map" resultType="noticeDTO">
		SELECT * FROM
		(SELECT T.*,ROWNUM R FROM (SELECT o.*,(SELECT COUNT(*)
		FROM NOTICE_COMMENT WHERE notice_no=o.notice_no) as notice_com_no FROM
		member m JOIN NOTICE_BOARD o ON m.userID=o.userID
		<if test="searchColumn !=null">
			WHERE ${searchColumn} LIKE '%' || #{searchWord} || '%'
		</if>

		ORDER BY no DESC) T)
		WHERE R BETWEEN #{start} AND #{end}
	</select>
	
	<select id="noticeGetTotalRecord" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) FROM NOTICE_BOARD o JOIN member m ON o.userID=m.userID
		<if test="searchColumn !=null">
			WHERE ${searchColumn} LIKE '%' || #{searchWord} || '%'
		</if>
	</select>

	<insert id="noticeInsert" parameterType="java.util.Map">
		INSERT INTO
		NOTICE_BOARD(notice_no,title,content,userID)
		VALUES(SEQ_NOTICE_NO.NEXTVAL,#{title},#{content},#{userID})
	</insert>
	
	<select id="noticeSelectOne" parameterType="java.util.Map" resultMap="noticeDTOResult">
		SELECT o.*, FROM member m JOIN NOTICE_BOARD o ON
		m.userID=o.userID
		WHERE notice_no=#{notice_no}
	</select>
	
	<update id="noticeUpdate" parameterType="java.util.Map">
		UPDATE NOTICE_BOARD SET
		title=#{title},content=#{content}
		WHERE notice_no = #{notice_no}
	</update>
	
	<delete id="noticeDelete" parameterType="java.util.Map">
		DELETE NOTICE_BOARD
		WHERE notice_no=#{notice_no}
	</delete>

</mapper>